---
id: typescript
title: Resonate HQ TypeScript SDK
sidebar_label: TypeScript SDK
description: Get started with the Resonate HQ TypeScript SDK.
last_update:
  date: "08-22-2024"
pagination_next: null
pagination_prev: null
tags:
  - get-started
  - typescript
  - sdk-guidance
---

import fan from "/img/fan.png";

Welcome to Resonate HQ TypeScript SDK guide!
This SDK makes it possible to write distributed async/await applications with TypeScript.
This guide covers installation and features that the SDK offers.

:::tip

If you are new to Resonate, we recommend following the **[Resonate HQ TypeScript SDK quickstart tutorial](/get-started/typescript-quickstart)** to get started learning how to use Resonate.

:::

## Installation

**How to install and use the TypeScript SDK in your project.**

To install the SDK in your project you can use npm or yarn.

**npm**

```shell
npm install @resonatehq/sdk
```

**yarn**

```shell
yarn add @resonatehq/sdk
```

Then, create a top-level Resonate object in your project file.

```ts
import { Resonate } from "@resonatehq/sdk";

const resonate = new Resonate();
```

After that, register your top-level function with the Resonate object using `resonate.register()`, provide a function unique identifier (UID) and a function pointer and then call `resonate.start()`.
You can then invoke the registered function using `resonate.run()` by passing the function's UID, a UID for corresponding promise, and any required arguments.

```ts
import { Resonate, Context } from "@resonatehq/sdk";

const resonate = new Resonate();

resonate.register("purchase", purchase);

resonate.start();

resonate.run("purchase", uid, user, song);
```

With `resonate.run()`, your code execution will complete even in the presence of hardware or software failures.
Any part of your application that calls `resonate.run()` is considered a Resonate Application Node, and maintans its own call graph.

## Schedules

**How to schedule function executions with the Resonate TypeScript SDK.**

You can also execute your function periodically with a cron expression.

```ts
resonate.register("purchase", purchase);

// Schedule a resonate function that is already registered.
resonate.schedule("everyMinute", "* * * * *", "purchase");

// Schedule and register a resonate function in one.
resonate.schedule("everyMinute", "* * * * *", (ctx: Context) => {
  console.log("every minute", Date.now());
});
```

## Execution Modes

Resonate offers two execution modes: Default and Durable.

#### Default Mode

In the default mode, Resonate utilizes a volatile in-memory promise store. This mode provides out-of-the-box features like automatic retries, tracing, and logging without requiring any additional infrastructure.

```ts
import { Resonate } from "@resonatehq/sdk";

const resonate = new Resonate();
```

#### Durable Mode

For advanced use cases requiring recoverability, stateful reminders, and a distributed task framework, configure Resonate to use a durable promise store.
To enable durable mode, [run the Resonate Server locally](/get-started/server-installation) and pass the server's address when initializing Resonate:

```ts
import { Resonate } from "@resonatehq/sdk";

const resonate = new Resonate({
  url: "http://localhost:8001",
});
```

## Resonate Context

Interactions with the runtime occur through the `Resonate Context`, which provides methods like `ctx.run()` and `ctx.sleep()`. These methods offer automatic retries, recoverability, task distribution, and more. All top-level functions (invoked by `resonate.run()`) and intermediary functions (invoked by `ctx.run()`) must accept a Resonate context as their first argument.

```ts
async function purchase(ctx: Context, user: User, song: Song): Promise<Status> {
  const charged = await ctx.run(charge, user, song);
  const granted = await ctx.run(access, user, song);
  return { charged, granted };
}

async function charge(ctx: Context, user: User, song: Song): Promise<boolean> {
  console.log(`Charged user:${user.id} $${song.price}.`);
  return true;
}

async function access(ctx: Context, user: User, song: Song): Promise<boolean> {
  console.log(`Granted user:${user.id} access to song:${song.id}.`);
  return true;
}
```

### In-Process

In-process execution enables durable execution of functions within the same process by passing a function pointer to a local function followed by its arguments.

```ts
const result = ctx.run(download, arg1, arg2, ...);
```

### Out-Process

:::note
Out-process execution requires the Resonate server and proper configuration to route tasks to workers.
Refer to the [Operate docs](/operate) for more information.
:::

Out-of-process execution allows you to dispatch the execution of multiple tasks and collect the results of those executions. Offloading tasks to dedicated workers occurs by passing a URL to an available worker along with its arguments. This approach enables you to perform the fan-out/fan-in pattern.

<center>
  <img src={fan} alt="fan" width="500" />
</center>

```ts
const result = await ctx.run(`/gpu/summarize/${url}`, arg);
```

### Sleeping

Resonate keeps track of timers and executes them, even across failures and restarts. To sleep in a Resonate application for a whole day, do the following:

```ts
await ctx.sleep(86_400_000);
```

## Configurations

Resonate offers various configuration options to customize its behavior. If options are not provided, sensible defaults are used.

### Global Configuration

Configure the SDK globally via the top-level Resonate object:

```ts
import { Resonate, Retry } from "@resonatehq/sdk";

const resonate = new Resonate({
  url: "https://my-remote-store.com", // The remote promise store URL. If not provided, an in-memory promise store will be used.
  retry: Retry.exponential(
    100, // initial delay (in ms)
    2, // backoff factor
    Infinity, // max attempts
    60000 // max delay (in ms, 1 minute)
  ),
  timeout: 5000, // The default promise timeout in ms, used for every function executed by calling run. Defaults to 1000.
  tags: { foo: "bar" }, // Tags to add to all durable promises.
});
```

### Function-specific Configuration

When registering functions with `resonate.register()`, provide function-specific options:

```ts
resonate.register(
  "downloadAndSummarize",
  downloadAndSummarize,
  resonate.options({
    timeout: Number.MAX_SAFE_INTEGER, // Overrides the default timeout.
    retry: Retry.linear(), // Overrides the default retry policy.
    tags: { bar: "baz" }, // Additional tags to add to the durable promise.
  })
);
```

Additionally, override functions in `ctx.run()`:

:::note
The options, such as timeout, cannot exceed the parent function. If it does, the minimum will take precedence.
:::

```ts
ctx.run(download, arg1, arg2, resonate.options({ ... }));
```

### Versioning

You can register multiple versions of a function with `resonate.register()`:

```ts
// Register `downloadAndSummarize` function with a version number of 2,
// a function pointer to a local function,
// and optionals configurations.
resonate.register(
  "downloadAndSummarize",
  downloadAndSummarize,
  resonate.options({
    version: 2,
  })
);
```

You can specify which version to run as an option on run. By default the function registered with the greatest (latest) version will be chosen.

```ts
resonate.run("downloadAndSummarize", "uid", resonate.options({ version: 2 }));
```

Additionally, your function has access to `context.version`, telling it the version this execution was started with.

```ts
async function charge(ctx: Context, user: User, song: Song): Promise<boolean> {
  if (ctx.version == 1) {
    console.log(`Charged user:${user.id} $${song.price} with version 1`);
  } else {
    console.log(`Charged user:${user.id} $${song.price} with version 2`);
  }
  return true;
}
```

## Next Steps

We hope this guide has provided you with a solid foundation for working with the Resonate Typescript SDK. If you have any questions or need further assistance, don't hesitate to reach out to us. For next steps, consider the following:

- Refer to our [API reference](https://resonatehq.github.io/resonate-sdk-ts/index.html) for a complete list of available methods and options.
- Refer to our [TypeScript Quickstart Repo](https://github.com/resonatehq/quickstart-ts/tree/main) for in-depth code examples of the TypeScript SDK.
